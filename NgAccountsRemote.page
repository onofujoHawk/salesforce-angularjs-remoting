<!--
    AngularJS promises - Visualforce custom page
-->
<apex:page showHeader="false" 
           sidebar="false" 
           standardStylesheets="false"
           controller="NgAccountsRemoteCtrl"
           applyHtmlTag="true"
           applyBodyTag="true"
           docType="html-5.0" 
           cache="true">

    <!-- Static Resources -->
    <apex:includeScript value="{!$Resource.JQuery_3_1_0}"/>
    <apex:includeScript value="{!$Resource.AngularJS_1_5_8}"/>
    <apex:includeScript value="{!$Resource.UI_Bootstrap_0_13_0}"/>
    <apex:includeScript value="{!$Resource.NgBlock_UI_JS}"/>
    <apex:includeScript value="{!$Resource.Tether_JS_min}"/>
    <apex:includeScript value="{!$Resource.Bootstrap_JS_4_0}"/>
    <apex:includeScript value="{!$Resource.Angular_Locale_enUS}"/>
    <apex:includeScript value="{!$Resource.AngularAnimate_1_5_8}"/>
    <apex:stylesheet value="{!$Resource.NgBlock_UI_CSS}"/>
    <apex:stylesheet value="{!$Resource.Bootstrap_CSS_4_0}"/>
    <apex:stylesheet value="{!$Resource.Font_Awesome_2_0}"/>
    <apex:stylesheet value="{!$Resource.Custom_NgRemote}"/>

    <!-- HTML5 starts here -->
    <html lang="en-US" xmlns:ng="http://angularjs.org">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
        <meta name="viewport" content="width=device-width" />
        <title>SFDC Accounts</title>

        <!-- Stylesheet -->
        <style type="text/css">
            @import url('https://fonts.googleapis.com/css?family=Signika+Negative');
            .custom-font {
                font-family: 'Signika Negative', sans-serif !important;
            }
            .underline {
                padding-bottom: 5px !important;
                border-bottom: 2px solid !important;    
            }
            /*.vcenter {
                display: inline-block !important;
                vertical-align: middle !important;
                float: none !important;
            }*/
            table tr td:last-child {
                border-right-width: 1px;
            }
            table tr:last-child td {
                border-bottom-width: 1px;
            }
            .alert-fade.ng-enter {
                transition: 0.5s linear all;
                opacity: 0;
            }
            .alert-fade.ng-enter.ng-enter-active {
                opacity: 1;
            }
            .alert-fade.ng-leave {
                transition: 0.5s linear all;
                opacity: 1;
            }
            .alert-fade.ng-leave.ng-leave-active {
                opacity: 0;
            }
            .not_found {
                outline: none !important;
                border: 1px solid red !important;
                box-shadow: none !important;
            }
        </style>

    </head>
    <body class="ng-cloak" ng-app="AccountApp">

        <!-- Wrap all page content here -->
        <section id="Wrap">


            <!-- AngularJS controller starts here -->
            <div ng-controller="AccountCtrl" class="container">
                <!-- Header -->
                <div class="page-header">
                    <h1>SFDC App.&nbsp;&nbsp;<apex:image id="logo" value="{!$Resource.sfdc_logo}" width="100" height="65"/></h1>
                </div>
                
                <!-- Edit modal -->
                <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" 
                aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title custom_align" id="Heading">Edit this Account</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="UpdateForm" 
                                 role="form" 
                                 novalidate="true" 
                                 name="EditForm" 
                                 autocomplete="off" 
                                 ng-submit="updateRow($event)">

                                    <!-- Edit name -->
                                    <div class="form-group" ng-class="{ 'has-danger': EditForm.editName.$invalid && !EditForm.editName.$pristine }">
                                        <label for="Name" class="custom-font">Name: </label>
                                        <input class="form-control" type="text" placeholder="{{ formData.Name }}" autocomplete="off" ng-model="accounts.name" required="false" name="editName" id="Name" ng-minlength="3"/>
                                        <small ng-show="EditForm.editName.$error.minlength" class="msg-error">Name is too short.</small>
                                    </div>

                                    <!-- Edit billing street -->
                                    <div class="form-group" ng-class="{ 'has-danger': EditForm.editBillingStreet.$invalid && !EditForm.editBillingStreet.$pristine }">
                                        <label for="Billing" class="custom-font">Billing Street: </label>
                                        <input class="form-control" type="text" placeholder="{{ formData.BillingStreet }}" autocomplete="off" ng-model="accounts.billingStreet" required="false" id="Billing" 
                                        name="editBillingStreet" ng-minlength="4"/>
                                        <small ng-show="EditForm.editBillingStreet.$error.minlength" 
                                        class="msg-error">Billing Street is too short.</small>
                                    </div>

                                    <!-- Edit number of employees -->
                                    <div class="form-group" ng-class="{ 'has-danger': EditForm.editNumOfEmp.$invalid && !EditForm.editNumOfEmp.$pristine }">
                                        <label for="NumEmp" class="custom-font">Number of Employees: </label>
                                        <input class="form-control" type="text" placeholder="{{ formData.NumberOfEmployees }}" autocomplete="off" ng-model="accounts.numberOfEmployees" required="false" id="NumEmp" 
                                        name="editNumOfEmp" ng-pattern="onlyNumbers" />
                                        <small ng-show="EditForm.editNumOfEmp.$error.pattern" class="msg-error" 
                                        id="NumEmpInvalid">Only numbers are allowed here.</small>
                                        <small ng-show="EditForm.editBillingStreet.$error.minlength" 
                                        class="msg-error">Number of Employees cannot be zero.</small>
                                    </div>

                                    <!-- Edit annual revenue -->
                                    <div class="form-group" ng-class="{ 'has-danger': EditForm.editAnnualRevenue.$invalid && !EditForm.editAnnualRevenue.$pristine }">
                                        <label for="AnnualRevenue" class="custom-font">Annual Revenue: </label>
                                        <input 
                                        class="form-control" 
                                        type="text" 
                                        placeholder="{{ formData.AnnualRevenue }}" 
                                        autocomplete="off" 
                                        ng-model="accounts.annualRevenue" 
                                        required="false" 
                                        name="editAnnualRevenue" 
                                        id="AnnualRevenue" />

                                    </div>

                                    <!-- Edit industry -->
                                    <div class="form-group" ng-class="{ 'has-danger': EditForm.editIndustry.$invalid && !EditForm.editIndustry.$pristine }">
                                        <label for="Industry" class="custom-font">Industry: </label>
                                        <input class="form-control" type="text" placeholder="{{ formData.Industry }}" autocomplete="false" ng-model="accounts.industry" required="false" 
                                        id="Industry" name="editIndustry"/>
                                    </div>


                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-warning btn-lg" style="width: 100%;">
                                    <span class="glyphicon glyphicon-ok-sign"></span> Update
                                </button>
                            </div>
                        </div>
                    <!-- /.modal-content --> 
                    </div>
                <!-- /.modal-dialog --> 
                </div>
                
                <!-- Deletion modal -->
                <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="edit" 
                aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title custom_align" id="Heading">Wait a second!</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                            </div>
                            <div class="modal-body">
                   
                                <div class="alert alert-danger"><span class="glyphicon glyphicon-warning-sign">
                                    </span>&nbsp; Are you sure you want to delete this Record?
                                </div>
                   
                            </div>
                            <div class="modal-footer ">
                                <button type="button" class="btn btn-success" ng-click="remove($event)"><span class="glyphicon glyphicon-ok-sign"></span> Yes
                                </button>
                                <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> No
                                </button>
                            </div>  
                        </div>
                    <!-- /.modal-content --> 
                    </div>
                <!-- /.modal-dialog --> 
                </div>

                <!-- Alert message -->
                <alert ng-repeat="alert in alerts" type="{{alert.type}}" class="alert-fade" 
                close="closeAlert($index)">
                    <strong>{{ alert.label }}</strong>&nbsp;&nbsp;{{ alert.msg }}
                </alert>

                <!-- Table panel -->
                <div class="col-md-12 col-md-offset-2">
                    <div class="panel panel-default panel-table">
                        <!-- HEADING -->
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col col-xs-6">
                                    <h3 class="panel-title">Accounts</h3>
                                </div>
                                <div class="col col-xs-6 pull-right form-group">

                                    <!-- search a contact -->
                                    <input type="text" ng-model="criteria" ng-change="search()" id="Filter" 
                                    ng-keyup="fetchByFilter($event)" placeholder="Search..."
                                    class="form-control" ng-class="{ 'not_found': pagedItems.length == 0 }"/>
                                    
                                </div>
                            </div>
                        </div>
                        <!-- BODY -->
                        <div class="panel-body">

	                        <!-- display the contacts -->
			                <table cellpadding="0" cellspacing="0" border="0" 
			                class="table table-striped table-list" width="100%">
			                    <thead class="thead-inverse">
			                        <tr>
			                            <th>No.</th>
			                            <th class="name">Name &nbsp;<a ng-click="sort_by('name')">
			                            <i class="icon-sort"></i></a></th>
			                            <th class="billingStreet">Billing Street &nbsp;<a ng-click="sort_by('billingStreet')"><i class="icon-sort"></i></a>
			                            </th>
			                            <th class="numberOfEmployees">No. of Employees &nbsp;<a ng-click="sort_by('numberOfEmployees')"><i class="icon-sort"></i></a>
			                            </th>
			                            <th class="annualRevenue">Annual Revenue &nbsp;<a ng-click="sort_by('annualRevenue')"><i class="icon-sort"></i>
			                            </a></th>
			                            <th class="industry">Industry &nbsp;<a ng-click="sort_by('industry')"><i class="icon-sort"></i>
			                            </a></th>
			                            <th>Edit</th>
			                            <th>Delete</th>
			                        </tr>
			                    </thead>
			                    <tbody>
			                        
			                        <!-- <tr ng-show="ContactData.length != 0" ng-repeat="contact in ContactData | filter: query track by $index"> -->
			                        
			                        <tr ng-show="pagedItems.length != 0" 
			                       	ng-repeat="item in pagedItems[currentPage] | orderBy:sortingOrder:reverse track by $index">
			                            <td style="font-weight: bold;">
			                            {{ $index + 1 }}</td>
			                            <td>{{ item.Name }}</td>
			                            <td>{{ item.BillingStreet }}</td>
			                            <td>{{ item.NumberOfEmployees }}</td>
			                            <td>{{ item.AnnualRevenue | currency: 'USD$' }}</td>
			                            <td>{{ item.Industry }}</td>
			                            <td>
			                                <p>
			                                    <button class="btn btn-outline-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit" ng-click="fnClick(item, $index)">
			                                        <small><span class="glyphicon glyphicon-pencil"></span></small>
			                                    </button>
			                                </p>
			                            </td>
			                            <td>
			                                <p>
			                                    <button class="btn btn-outline-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete" ng-click="fnClick(item, $index)">
			                                        <small><span class="glyphicon glyphicon-trash"></span></small>
			                                    </button>
			                                </p>
			                            </td>
			                        </tr>
			                    </tbody>
			                </table>

			                <div ng-show="pagedItems.length == 0">
			                    No data.                
			                </div>

                        </div>
                        <!-- FOOTER -->
                        <div class="panel-footer" ng-hide="pagedItems.length == 0">
                            <div class="row">
                                <div id="Page" class="col col-xs-6" style="font-weight: bold;">
                                    Page {{ currentPage+1 }} of {{ pagedItems.length }}
                                </div>
                                <div class="col col-xs-6">
                                    <!-- Pagination -->
                                    <div id="Paginator">
                                        
                                        <ul class="pagination pagination-large pull-right">
                                        	<!-- left -->
                                            <li class="page-item" ng-class="{disabled: currentPage == 0}">
                                                <a class="page-link visible-xs" ng-click="prevPage()">
                                                    <span class="glyphicon glyphicon-chevron-left">
                                                    </span>
                                                </a>
                                            </li>
                                            <!-- numbers -->
                                            <li ng-repeat="n in range(pagedItems.length)"
                                            ng-class="{active: n == currentPage}"
                                            ng-click="setPage()" class="page-item hidden-xs">
                                                <a class="page-link" ng-bind="n + 1">1</a>
                                            </li>
                                            <!-- right -->
                                            <li class="page-item" 
                                            ng-class="{disabled: currentPage == pagedItems.length - 1}">
                                                <a class="page-link visible-xs" ng-click="nextPage()">
                                                    <span class="glyphicon glyphicon-chevron-right">
                                                    </span>
                                                </a>
                                            </li>
                                        </ul>

                                    </div>
                                </div>
                                <!-- end paginator -->
                            </div>
                            <!-- end row -->
                        </div>
                        <!-- end panel footer -->
                    </div>
                    <!-- end panel table -->
                </div>
                <!-- end offset panel -->
            </div>

        </section><!-- Wrap end -->

        <!-- Footer -->
        <footer id="Footer">
            <div class="container">
                <div class="row text-center">
                    <div class="col-md-12 col-xs-12 col-md-offset-2">
                        <ul class="list-inline">
                            <li class="list-inline-item">
                                <a href="https://www.facebook.com/onofwest">
                                <i class="fa fa-facebook fa-2x"></i></a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.dropbox.com/home">
                                <i class="fa fa-dropbox fa-2x"></i></a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://github.com/onofujoHawk/">
                                <i class="fa fa-github fa-2x"></i></a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.linkedin.com/in/onofrio-falco-009932102/">
                                <i class="fa fa-linkedin fa-2x"></i></a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://plus.google.com/u/0/103875186566707860709">
                                <i class="fa fa-google-plus fa-2x"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row text-center">  
                    <div class="col-md-12 col-xs-12 col-md-offset-2"> 
                        <ul class="menu list-inline">
                            <li class="list-inline-item">
                                <apex:outputLink value="{!goToHomepage}" target="_parent">Home</apex:outputLink>
                            </li>
                            <li class="list-inline-item">
                                <apex:outputLink value="{!goToContacts}" target="_parent">Contacts</apex:outputLink>
                            </li>
                            <li class="list-inline-item">
                                <apex:outputLink value="{!goToAccounts}" target="_parent">Accounts</apex:outputLink>
                            </li>
                        </ul>
                    </div>
                 </div>    

                <!-- <div class="credits">
                    <p>SFDC App ©2017, All Rights Reserved.
                        <br/>
                        <span><a href="https://www.linkedin.com/in/onofrio-falco-009932102/" 
                        style="color: White;">Onofrio Falco</a>&nbsp;<i class="fa fa-linkedin-square" aria-hidden="true"></i></span>
                    </p>
                </div> -->

            </div>
        </footer>
    
        <div class="copyright">
            <div class="container">
                <div class="text-center">
                    <p class="custom-font">
                        SFDC App ©2017. All rights reserved &nbsp;&nbsp;
                        <apex:image id="sfdc" value="{!$Resource.sfdc_logo}" width="60" height="40"/>
                    </p>
                </div>
            </div>
        </div>


    </body>
    <!-- AngularJS layer -->
    <script type="text/javascript">

        'use strict';
        var app = angular.module('AccountApp', ['ui.bootstrap', 'ngAnimate']);

        /**
         * Main app factory method
         */
        app.factory('VFRemotingFactory', function($q, $rootScope) {
            var factory = {};
            factory.getByFilter = function(searchText) {
                var deferred = $q.defer();
                getByFilterCallback(function(result) {
                    $rootScope.$apply(function() {
                        deferred.resolve(result);
                    });
                }, searchText);
                return deferred.promise;
            };
            factory.deleteById = function(id) {
                var deferred = $q.defer();
                deleteByIdCallback(function(result) {
                    $rootScope.$apply(function() {
                        deferred.resolve(result);
                    });
                }, id);
                return deferred.promise;
            };
            factory.merge = function(contact) {
                var deferred = $q.defer();
                mergeCallback(function(result) {
                    $rootScope.$apply(function() {
                        deferred.resolve(result);
                    });
                }, contact);
                return deferred.promise;
            }
            return factory;
        });

        /**
         * Main app Controller
         */
        var ctrl = app.controller('AccountCtrl', ['$rootScope', '$scope', '$q', '$log', '$filter', 
        	'VFRemotingFactory', function($rootScope, $scope, $q, $log, $filter, VFRemotingFactory) {

            //Controller structured members
            $scope.accounts = {};
            $scope.pagedItems = [];
            $scope.filteredItems = [];
            $scope.groupedItems = [];

            //Controller default members
            $scope.itemsPerPage = 10;
            $scope.query = "";
            $scope.currentPage = 0;
            $scope.reverse = false;
            $scope.sortingOrder = sortingOrder;

            $scope.alerts = [];
            var count = 1;

            //get Contacts as JSON
            $scope.AccountData = JSON.parse('{! JSENCODE(accountListJSON) }');

            //get Contact by Criteria
            $scope.fetchByFilter = function($event) {
                $log.info('Get contact filtered');
                if ($scope.criteria.length > 1) {
                    var searchTxt = $scope.criteria;
                    VFRemotingFactory.getByFilter(searchTxt)
                        .then(function(result) {
                            $scope.AccountData = result;
                        });
                } else {
                    var searchTxt = $scope.criteria;
                    VFRemotingFactory.getByFilter()
                        .then(function(result) {
                            $scope.AccountData = result;
                        });
                }
            };    

            $scope.updateRow = function($event) {
                $log.info('Update');
                var accountJS = new Account();
                var copy = angular.copy($scope.formData);
                if ($scope.accounts.name !== null) {
                	accountJS.name = $scope.accounts.name;
                }
                if ($scope.accounts.billingStreet !== null) {
                    accountJS.billingStreet = $scope.accounts.billingStreet;
                }
                if ($scope.accounts.industry !== null) {
                    accountJS.industry = $scope.accounts.industry;
                }
                if ($scope.accounts.numberOfEmployees !== null) {
                    accountJS.numberOfEmployees = $scope.accounts.numberOfEmployees;
                }
                if ($scope.accounts.annualRevenue !== null) {
                    accountJS.annualRevenue = $scope.accounts.annualRevenue;
                }
                $log.info('Account to update ' + accountJS);
                if (!isEmpty(accountJS) && !equals(accountJS, $scope.formData)) {
                    VFRemotingFactory.merge(accountJS)
                        .then(function(result) {
                            $log.info('Callback update. result: ' + result);
                            if (result === null) {
                                $log.error('result is null or empty');
                                $scope.openAlert('warning', 'Warning!', 'Cannot update this Record.');
                            } else {
                                delete $scope.ContactData;
                                $scope.ContactData = result;
                                $scope.openAlert('success', 'Success!', 'Account updated successfully.');
                            }
                        }, 
                        function(error) {
                            $log.error('Error on update. error: ' + error);
                            $scope.openAlert('danger', 'Error!', 'An error has occurred during Account updating.');
                        });

                    //Close modal after async call
                    hideModal('#update');

                } else {
                    $log.warn('Nothing to update');
                    //Close modal after async call
                    hideModal('#update');
                    $scope.openAlert('warning', 'Warning!', 'Nothing to update here.');
                }
            }

            $scope.remove = function($event) {
                $log.info('Deletion of ', JSON.stringify($scope.formData));
                var accountID = $scope.formData.Id;
                $scope.CopyData = angular.copy($scope.AccountData);
                if (accountID !== undefined) {
                    VFRemotingFactory.deleteById(accountID)
                        .then(function(result) {
                            $log.log('Callback delete. result: ' + JSON.parse(result));
                            if (JSON.parse(result) === null) {
                                $log.error('result is null or empty');
                                $scope.openAlert('warning', 'Warning!', 'Cannot delete this Record.');
                            } else {
                                delete $scope.AccountData;
                                $scope.AccountData = JSON.parse(result);
                                $scope.openAlert('success', 'Success!', 'Contact removed successfully.');
                            }
                        }, 
                        function(error) {
                            $log.error('Error on deletion. error: ' + error);
                            $scope.openAlert('danger', 'Error!', 'An error has occurred during Contact deletion.');
                        });

                    //Close modal after async call
                    hideModal('#delete');

                } else {
                    $log.warn('accountID field is empty');
                }
            }

            //Account object
            function Account() {
                this.name = null,
                this.billingStreet = null,
                this.numberOfEmployees = null,
                this.annualRevenue = null,
                this.industry = null
            }

            $scope.fnClick = function(usr, index) { 
                $scope.formData = angular.copy($scope.pagedItems[$scope.currentPage][index]); 
                //Set index  
                $scope.formData.Index = index;
                console.log('Selected row', JSON.stringify($scope.formData.Name));
            }

            var searchMatch = function(haystack, needle) {
                if (!needle) {
                    return true;
                }
                return haystack.toLowerCase().indexOf(needle.toLowerCase()) !== -1;
            };
            
            //Initialize the Search Filters 
            $scope.search = function() {
                $scope.filteredItems = $filter('filter')($scope.AccountData, function(item) {
                    for (var attr in item) {
                        if (searchMatch(item[attr], $scope.query))
                            return true;
                    }
                    return false;
                });
                // Define Sorting Order
                if ($scope.sortingOrder !== '') {
                    $scope.filteredItems = $filter('orderBy')($scope.filteredItems, 
                        $scope.sortingOrder, 
                        $scope.reverse);
                }
                $scope.currentPage = 0;
                
                // Group by pages
                $scope.groupToPages();
            };
            
            // Calculate Total Number of Pages based on Records Queried 
            $scope.groupToPages = function() {
                $scope.pagedItems = [];
                for (var i=0; i<$scope.filteredItems.length; i++) {
                    if (i % $scope.itemsPerPage === 0) {
                        $scope.pagedItems[Math.floor(i / $scope.itemsPerPage)] = [$scope.filteredItems[i]];
                    } else {
                        $scope.pagedItems[Math.floor(i / $scope.itemsPerPage)].push($scope.filteredItems[i]);
                    }
                }
            };
            
            $scope.range = function(start, end) {
                var ret = [];
                if (!end) {
                    end = start;
                    start = 0;
                }
                for (var i=start; i<end; i++) {
                    ret.push(i);
                }
                return ret;
            };
            
            $scope.prevPage = function() {
                if ($scope.currentPage > 0) {
                    $scope.currentPage--;
                }
            };
            
            $scope.nextPage = function() {
                if ($scope.currentPage < $scope.pagedItems.length - 1) {
                    $scope.currentPage++;
                }
            };
            $scope.setPage = function() {
                $scope.currentPage = this.n;
            };

            // functions have been describe process the data for display
            $scope.search();
            
            // change sorting order
            $scope.sort_by = function(newSortingOrder) {
                console.log('Sorting');
                if ($scope.sortingOrder == newSortingOrder) {
                    $scope.reverse = !$scope.reverse;
                }
                $scope.sortingOrder = newSortingOrder;
                
                // icon setup
                jq('th i').each(function() {
                    // icon reset
                    jq(this).removeClass().addClass('icon-sort');
                });
                if ($scope.reverse)
                    jq('th.' + newSortingOrder + ' i').removeClass().addClass('icon-chevron-up');
                else
                    jq('th.' + newSortingOrder + ' i').removeClass().addClass('icon-chevron-down');
            };

            //Set css property dynamically
            $scope.$watch('pagedItems', function() {
                if ($scope.pagedItems.length == 0) {
                    jq("#Paginator").css('padding-top', '12px');
                }
            });

            $scope.closeAlert = function(index) {
                $scope.alerts.splice(index, 1);
            };

            $scope.openAlert = function(type, labl, msg) {
                $scope.alerts.push({
                    type: type,
                    msg: msg,
                    label: labl
                });

            };


            
            
        }]);

        /**
         * SFDC Remote action callbacks
         */
        function getByFilterCallback(callback, searchText) {
            if (searchText == undefined) {
                searchText = '';
            }
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.NgAccountsRemoteCtrl.getAllByFilter}',
                searchText,
                callback, {
                    escape: false,
                    timeout: 120000
                }
            );
        };

        function deleteByIdCallback(callback, id) {
            if (id !== undefined && typeof id === 'string') {   
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.NgAccountsRemoteCtrl.deleteById}',
                    id,
                    callback, {
                        escape: false,
                        timeout: 120000
                    }
                );
            }
        };

        function mergeCallback(callback, contact) {
            if (typeof contact === 'object') {
                contact = JSON.stringify(contact);
            }
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.NgAccountsRemoteCtrl.updateAccount}',
                contact,
                callback, {
                    escape: false,
                    timeout: 120000
                }
            );
        };

    </script>
    <!-- JavaScript layer -->
    <script type="text/javascript">

        var jq = jQuery.noConflict();
        var sortingOrder = 'name';
        var $window = jq(window);

        /**
         * Set tooltip placement dynamically
         */
        setPlacement = function() {
            if ($window.width() > 514)
                return 'right';
            else
                return 'top';
        };
        
        /**
         * Close modal 
         */
        hideModal = function(sfId) {
            if (sfId.length !== 0) {
                if (!sfId.startsWith('#') && !sfId.startsWith(".")) {
                    sfId = "#" + sfId;
                }
                if (!sfId.startsWith(".") && !sfId.startsWith("#")) {
                    sfId = '.' + sfId;
                }
                jq(sfId).modal('hide');
            }
        }

        hidePagination = function(sfId) {
			if ($window.width() < 514)
                document.getElementById(sfId).style.display = 'none';
            else
                document.getElementById(sfId).style.display = 'block';
        }

        /**
         * Resize DOM element when detect Mobile screen
         */
        reSize = function(elem, cls) {
            $window.resize(function resize() {
                if ($window.width() < 514) {
                    return jq(elem).addClass(cls);
                }
                jq(elem).removeClass(cls);
            }).trigger('resize');   
        }
        
        /**
         * DOM event loader
         */
        jq(document).ready(function() {
        	//Dynamic active li
        	var $url = window.location.href.toLowerCase();
            if ($url.includes('account')) {
                var $li = jq('ul.menu.list-inline > li.list-inline-item');
                for (var i=0; i<$li.length; i++) {
                    if ($li[i].innerText.toLowerCase().includes('account')) {
                        jq($li[i]).children().css('color', '#7dabdb').addClass('underline');
                    }
                }
            }
            //Resize the Save contact button
            reSize('#Save', 'btn-block');

            //Resize the table setting new responsive class
            reSize('table', 'table-responsive');

            //Hide pagination
            hidePagination('Page');
            
            //Animation for alert when clicking on close button
            jq("div.alert").on("click", "button.close", function() {
                jq(this).parent().animate({opacity: 0}, 500).hide('slow');
            });
        });

        /*----- UTILS -----*/
        
        function isEmpty(obj) {
            for(var prop in obj) {
                if(obj.hasOwnProperty(prop))
                return false;
            }
            return true;
        }

        function equals(obj1, obj2) {
            return JSON.stringify(obj1) === JSON.stringify(obj2) 
        }
    
    </script>
    </html> 
</apex:page>